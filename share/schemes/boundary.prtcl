
let boundary = particle_selector types {boundary} tags {};

let x = field position : varying real[];

let V = field volume : varying real;

let h = field smoothing_scale : global real;

procedure compute_volume {
  foreach boundary particle b {
    compute V[b] = 0;
    foreach boundary neighbor b_b {
      compute V[b] += kernel_h(x[b] - x[b_b], h[_]);
    }
    compute V[b] = 1 / V[b];
  }
}

